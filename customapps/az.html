<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAESTRO AI Security Audit Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .threat-card {
            transition: all 0.3s ease;
        }
        .threat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">
                🛡️ MAESTRO AI Security Audit Platform
            </h1>
            <p class="text-xl text-white/90 drop-shadow">
                Multi-Agent Environment, Security, Threat, Risk, and Outcome Framework
            </p>
            <p class="text-sm text-white/80 mt-2">
                Integrated with OWASP AI Top 10 & MITRE ATLAS
            </p>
        </header>

        <!-- File Upload Section -->
        <div class="glassmorphism rounded-2xl p-8 mb-8 shadow-2xl">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                <span class="mr-3">📁</span> Upload System Architecture
            </h2>
            
            <div class="border-4 border-dashed border-white/40 rounded-xl p-8 text-center hover:border-white/60 transition-all cursor-pointer bg-white/5" id="dropZone">
                <input type="file" id="fileInput" multiple accept=".txt,.yml,.yaml,.json,.xml,.md,.py,.js,.ts,.jsx,.tsx,.java,.cpp,.c,.cs,.go,.rb,.php,.html,.css,.svg,.png,.jpg,.jpeg" class="hidden">
                <div class="text-white">
                    <svg class="mx-auto h-16 w-16 mb-4 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="text-xl font-semibold mb-2">Drop files here or click to upload</p>
                    <p class="text-sm opacity-80">Supports: Text, Code (Python, JS, Java, etc.), YAML, JSON, XML, Diagrams (SVG, PNG, JPG)</p>
                </div>
            </div>

            <div id="fileList" class="mt-6 space-y-2"></div>

            <button id="analyzeBtn" class="mt-6 w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-4 px-8 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                🔍 Analyze with MAESTRO Framework
            </button>
        </div>

        <!-- Framework Tabs -->
        <div class="glassmorphism rounded-2xl p-8 mb-8 shadow-2xl">
            <div class="flex border-b border-white/30 mb-6">
                <button class="tab-btn active px-6 py-3 font-semibold text-white border-b-4 border-purple-400 transition-all" data-tab="maestro">
                    MAESTRO Framework
                </button>
                <button class="tab-btn px-6 py-3 font-semibold text-white/70 hover:text-white border-b-4 border-transparent transition-all" data-tab="owasp">
                    OWASP AI Top 10
                </button>
                <button class="tab-btn px-6 py-3 font-semibold text-white/70 hover:text-white border-b-4 border-transparent transition-all" data-tab="mitre">
                    MITRE ATLAS
                </button>
            </div>

            <!-- Tabs content omitted for brevity (same as before) -->

        </div>

        <!-- Analysis Results -->
        <div id="resultsSection" class="hidden glassmorphism rounded-2xl p-8 shadow-2xl">
            <h2 class="text-3xl font-bold text-white mb-6">📋 Analysis Results</h2>
            <div id="analysisResults" class="space-y-4"></div>
            
            <button id="exportBtn" class="mt-6 bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-3 px-6 rounded-xl hover:from-green-700 hover:to-teal-700 transition-all shadow-lg">
                📥 Export Audit Report
            </button>
        </div>
    </div>

    <script>
        // State management
        let uploadedFiles = [];
        let analysisData = {};

        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resultsSection = document.getElementById('resultsSection');
        const analysisResults = document.getElementById('analysisResults');
        const exportBtn = document.getElementById('exportBtn');

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active', 'border-purple-400', 'text-white');
                    b.classList.add('text-white/70', 'border-transparent');
                });
                btn.classList.add('active', 'border-purple-400', 'text-white');
                btn.classList.remove('text-white/70', 'border-transparent');
                document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            });
        });

        // File handling
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('border-white/80', 'bg-white/10'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-white/80', 'bg-white/10'));
        dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('border-white/80', 'bg-white/10'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', e => handleFiles(e.target.files));

        function handleFiles(files) {
            uploadedFiles = [...uploadedFiles, ...Array.from(files)];
            displayFiles();
            analyzeBtn.disabled = false;
        }

        function displayFiles() {
            fileList.innerHTML = uploadedFiles.map((file, i) => `
                <div class="flex items-center justify-between bg-white/10 rounded-lg p-4 border border-white/20">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${getFileIcon(file.name)}</span>
                        <div>
                            <p class="text-white font-semibold">${file.name}</p>
                            <p class="text-white/60 text-sm">${formatFileSize(file.size)}</p>
                        </div>
                    </div>
                    <button onclick="removeFile(${i})" class="text-red-400 hover:text-red-300 font-bold">✕</button>
                </div>`).join('');
        }

        function removeFile(index) { uploadedFiles.splice(index, 1); displayFiles(); analyzeBtn.disabled = uploadedFiles.length === 0; }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = { py:'🐍', js:'📜', ts:'📘', java:'☕', yml:'⚙️', yaml:'⚙️', json:'📋', xml:'📄', txt:'📝', md:'📖', svg:'🎨', png:'🖼️', jpg:'🖼️', jpeg:'🖼️' };
            return icons[ext] || '📄';
        }

        function formatFileSize(bytes){ if(bytes<1024)return bytes+' B'; if(bytes<1048576)return (bytes/1024).toFixed(1)+' KB'; return (bytes/1048576).toFixed(1)+' MB'; }

        analyzeBtn.addEventListener('click', async () => {
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '🔄 Analyzing...';
            await new Promise(r=>setTimeout(r,2000));
            const contents = await Promise.all(uploadedFiles.map(readFileContent));
            performAnalysis(contents);
            analyzeBtn.innerHTML = '✅ Analysis Complete';
            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({behavior:'smooth'});
            setTimeout(()=>{ analyzeBtn.innerHTML='🔍 Analyze with MAESTRO Framework'; analyzeBtn.disabled=false; },2000);
        });

        async function readFileContent(file){ return new Promise(r=>{const reader=new FileReader(); reader.onload=e=>r({name:file.name,type:file.type,content:e.target.result,size:file.size}); if(file.type.startsWith('image/'))reader.readAsDataURL(file); else reader.readAsText(file);}); }

        function performAnalysis(files){ analysisData={timestamp:new Date().toISOString(),files:files.length,findings:[]}; files.forEach(f=>analysisData.findings.push(...analyzeFile(f))); displayResults(); }

        function analyzeFile(file){
            const f=[], c=file.content.toLowerCase();
            const patterns={
                'Potential Prompt Injection Risk':['eval(','exec(','system(','shell_exec'],
                'Hardcoded Credentials':['password','api_key','secret','token'],
                'Insecure Data Handling':['pickle.loads','yaml.load(','json.loads'],
                'Missing Input Validation':['request.args','request.form','input('],
                'Potential Model Access':['model.load','torch.load','keras.load'],
                'External API Calls':['requests.','urllib','http.client'],
            };
            Object.entries(patterns).forEach(([t,keys])=>keys.forEach(k=>{if(c.includes(k))f.push({file:file.name,threat:t,severity:calcSeverity(t),framework:mapFramework(t),detail:`Found "${k}" in ${file.name}`});}));
            return f;
        }

        function calcSeverity(t){ if(/Prompt Injection|Credentials|Model Access/.test(t))return'HIGH'; if(/Validation|Data Handling/.test(t))return'MEDIUM'; return'LOW'; }
        function mapFramework(t){
            if(t.includes('Prompt Injection'))return['OWASP: LLM01','MITRE: AML.T0051'];
            if(t.includes('Input Validation'))return['OWASP: LLM02','MAESTRO: Security'];
            if(t.includes('Model'))return['OWASP: LLM10','MITRE: AML.T0040'];
            if(t.includes('Credentials'))return['OWASP: LLM06','MAESTRO: Security'];
            return['MAESTRO: Threat'];
        }

        // Updated DisplayResults with external links
        function displayResults(){
            const counts={HIGH:analysisData.findings.filter(f=>f.severity==='HIGH').length,MEDIUM:analysisData.findings.filter(f=>f.severity==='MEDIUM').length,LOW:analysisData.findings.filter(f=>f.severity==='LOW').length};
            const links={
                'OWASP: LLM01':'https://owasp.org/www-project-top-10-for-large-language-model-applications/',
                'OWASP: LLM02':'https://owasp.org/www-project-top-10-for-large-language-model-applications/',
                'OWASP: LLM06':'https://owasp.org/www-project-top-10-for-large-language-model-applications/',
                'OWASP: LLM10':'https://owasp.org/www-project-top-10-for-large-language-model-applications/',
                'MITRE: AML.T0051':'https://atlas.mitre.org/techniques/AML.T0051/',
                'MITRE: AML.T0040':'https://atlas.mitre.org/techniques/AML.T0040/',
                'MAESTRO: Security':'https://zactonics.github.io/maestro-framework/',
                'MAESTRO: Threat':'https://zactonics.github.io/maestro-framework/'
            };

            analysisResults.innerHTML=`
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-blue-500/30 to-blue-600/30 rounded-xl p-6 border border-blue-400/30">
                    <div class="text-3xl font-bold text-white">${analysisData.files}</div><div class="text-white/80 text-sm">Files Analyzed</div></div>
                <div class="bg-gradient-to-br from-red-500/30 to-red-600/30 rounded-xl p-6 border border-red-400/30">
                    <div class="text-3xl font-bold text-white">${counts.HIGH}</div><div class="text-white/80 text-sm">High Severity</div></div>
                <div class="bg-gradient-to-br from-orange-500/30 to-orange-600/30 rounded-xl p-6 border border-orange-400/30">
                    <div class="text-3xl font-bold text-white">${counts.MEDIUM}</div><div class="text-white/80 text-sm">Medium Severity</div></div>
                <div class="bg-gradient-to-br from-yellow-500/30 to-yellow-600/30 rounded-xl p-6 border border-yellow-400/30">
                    <div class="text-3xl font-bold text-white">${counts.LOW}</div><div class="text-white/80 text-sm">Low Severity</div></div>
            </div>
            <div class="space-y-3">
            ${
                analysisData.findings.length>0?
                analysisData.findings.map(f=>`
                    <div class="bg-white/10 rounded-xl p-5 border border-white/20">
                        <div class="flex items-start justify-between mb-3">
                            <h4 class="text-lg font-bold text-white">${f.threat}</h4>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${f.severity==='HIGH'?'bg-red-500':f.severity==='MEDIUM'?'bg-orange-500':'bg-yellow-500'} text-white">${f.severity}</span>
                        </div>
                        <p class="text-white/70 text-sm mb-2">${f.detail}</p>
                        <div class="flex flex-wrap gap-2 mb-2">
                        ${f.framework.map(fw=>{
                            const l=links[fw]||'#';
                            return `<a href="${l}" target="_blank" class="px-2 py-1 bg-purple-500/30 rounded text-xs text-white border border-purple-400/30 hover:bg-purple-600/40 transition">${fw} 🔗</a>`;
                        }).join('')}
                        </div>
                    </div>`).join(''):
                    '<div class="text-center text-white/70 py-8">✅ No security issues detected in uploaded files</div>'
            }
            </div>`;
        }

        exportBtn.addEventListener('click',()=>{const t=generateReport();const b=new Blob([t],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`MAESTRO_Audit_Report_${Date.now()}.txt`;a.click();URL.revokeObjectURL(u);});

        function generateReport(){
            return `
MAESTRO AI SECURITY AUDIT REPORT
=================================
Generated: ${new Date().toLocaleString()}
Files Analyzed: ${analysisData.files}

EXECUTIVE SUMMARY
-----------------
Total Findings: ${analysisData.findings.length}
- High Severity: ${analysisData.findings.filter(f=>f.severity==='HIGH').length}
- Medium Severity: ${analysisData.findings.filter(f=>f.severity==='MEDIUM').length}
- Low Severity: ${analysisData.findings.filter(f=>f.severity==='LOW').length}

DETAILED FINDINGS
-----------------
${analysisData.findings.map((f,i)=>`${i+1}. ${f.threat}
   Severity: ${f.severity}
   File: ${f.file}
   Details: ${f.detail}
   Frameworks: ${f.framework.join(', ')}
`).join('\n')}

RECOMMENDATIONS
---------------
1. Review all HIGH severity findings immediately
2. Implement input validation and sanitization
3. Remove hardcoded credentials
4. Add authentication and authorization controls
5. Implement model access monitoring
6. Regular security audits using MAESTRO framework
7. Follow OWASP AI Top 10 best practices
8. Monitor for MITRE ATLAS threat patterns
---
Generated by MAESTRO AI Security Audit Platform`.trim();
        }
    </script>
</body>
