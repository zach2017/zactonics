<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Security+ Practice Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="light dark" />
    <style>
      /* Focus ring for accessibility */
      .kb-focus:focus-visible {
        outline: 3px solid rgba(59, 130, 246, 0.8);
        outline-offset: 2px;
        border-radius: 0.5rem;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50 text-gray-900 antialiased">
    <main class="max-w-4xl mx-auto p-6 sm:p-10">
      <header class="mb-6 sm:mb-10">
        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">
          Security+ (SY0-701) Practice Quiz
        </h1>
        <p class="text-gray-600 mt-2">
           Link: -- <a class="underline text-blue-600 hover:text-blue-800 visited:text-purple-600" href="https://www.comptia.org/en-us/certifications/security/">Security+ Details</a><br/>
           Link: -- <a class="underline text-blue-600 hover:text-blue-800 visited:text-purple-600" href="https://www.professormesser.com/sy0-701-certification-course/#">Security+ Study Video and Guides</a><br/>
          Comprehensive coverage • Hint on first miss • Full explanation on
          second miss • All five domains
          <br/>
        </p>
        <p class="text-red-600">Must score > 81 to pass based on 99 questions.</p>
      </header>

      <!-- Progress -->
      <section aria-label="Progress" class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <span id="progressText" class="text-sm font-medium text-gray-700"
            >Question 1 of 30</span
          >
          <span id="scoreText" class="text-sm text-gray-600">Score: 0</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div
            id="progressBar"
            class="bg-blue-600 h-2 rounded-full"
            style="width: 0%"
          ></div>
        </div>
      </section>

      <!-- Card -->
      <section id="card" class="bg-white shadow-sm rounded-2xl p-5 sm:p-7">
        <div class="flex items-center gap-2 mb-4">
          <span
            id="domainBadge"
            class="inline-flex items-center text-xs font-semibold px-2.5 py-1 rounded-full bg-blue-50 text-blue-700"
            >Domain</span
          >
        </div>

        <h2
          id="questionText"
          class="text-lg sm:text-xl font-semibold leading-snug"
        >
          Loading question…
        </h2>

        <div id="options" class="mt-5 grid gap-3"></div>

        <div id="feedback" class="mt-5 hidden">
          <div id="feedbackInner" class="rounded-xl border p-4"></div>
        </div>

        <div class="mt-6 flex items-center gap-3">
          <button
            id="nextBtn"
            class="kb-focus inline-flex items-center justify-center px-4 py-2.5 rounded-xl text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            Next →
          </button>
          <button
            id="revealBtn"
            class="kb-focus hidden inline-flex items-center justify-center px-3 py-2 rounded-xl text-sm font-medium bg-gray-100 hover:bg-gray-200"
          >
            Reveal Answer
          </button>
        </div>
      </section>

      <!-- Results -->
      <section
        id="results"
        class="hidden mt-8 bg-white shadow-sm rounded-2xl p-6"
      >
        <h3 class="text-xl font-bold mb-2">Your Results</h3>
        <p id="finalScore" class="text-gray-700 mb-4"></p>
        <div id="domainBreakdown" class="grid sm:grid-cols-2 gap-4 mb-6"></div>
        <button
          id="restartBtn"
          class="kb-focus inline-flex items-center justify-center px-4 py-2.5 rounded-xl text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700"
        >
          Restart Quiz
        </button>
      </section>

      <footer class="mt-10 text-xs text-gray-500">
        Tip: Use this to drill daily. Say answers out loud to build exam speed
        and clarity.
      </footer>
    </main>

    <script>
      // ---------------------------
      // Comprehensive Question Bank (30 questions - 6 per domain)
      // ---------------------------
      const QUESTIONS = [
        // =====================================================
        // DOMAIN 1: General Security Concepts (6 questions)
        // =====================================================
        {
          id: "D1-Q1",
          domain: "Domain 1: General Security Concepts",
          question:
            "Which part of the CIA triad ensures information is not altered in transit?",
          choices: [
            "Confidentiality",
            "Integrity",
            "Availability",
            "Non-repudiation",
          ],
          answer: 1,
          hint: "Consider what hashing verifies.",
          explanation:
            "Integrity ensures data is accurate and unaltered. Hashes (e.g., SHA-256) detect changes during transmission or storage.",
        },
        {
          id: "D1-Q2",
          domain: "Domain 1: General Security Concepts",
          question:
            "A company adds MFA to VPN logins. Which security principle does this primarily strengthen?",
          choices: [
            "Authorization",
            "Accounting",
            "Authentication",
            "Availability",
          ],
          answer: 2,
          hint: "Think about proving identity.",
          explanation:
            "MFA strengthens authentication by requiring multiple factors (something you know, have, or are) to prove user identity.",
        },
        {
          id: "D1-Q3",
          domain: "Domain 1: General Security Concepts",
          question:
            "Which control type is a security guard checking IDs at a data center?",
          choices: [
            "Administrative, preventive",
            "Technical, detective",
            "Physical, preventive",
            "Compensating, corrective",
          ],
          answer: 2,
          hint: "It's a tangible barrier involving people.",
          explanation:
            "A guard is a physical control (person, barrier, lock), and ID checking helps prevent unauthorized access before it occurs.",
        },
        {
          id: "D1-Q4",
          domain: "Domain 1: General Security Concepts",
          question: "What does non-repudiation primarily prevent?",
          choices: [
            "Data corruption",
            "Denial of actions taken",
            "Unauthorized access",
            "System downtime",
          ],
          answer: 1,
          hint: "Think about someone saying 'I didn't do that.'",
          explanation:
            "Non-repudiation prevents users from denying actions they performed, typically achieved through digital signatures and audit logs.",
        },
        {
          id: "D1-Q5",
          domain: "Domain 1: General Security Concepts",
          question:
            "Which principle requires users to have only the minimum access needed for their job?",
          choices: [
            "Defense in depth",
            "Least privilege",
            "Separation of duties",
            "Due diligence",
          ],
          answer: 1,
          hint: "Think minimal access rights.",
          explanation:
            "Least privilege ensures users have only the minimum permissions necessary to perform their job functions, reducing attack surface.",
        },
        {
          id: "D1-Q6",
          domain: "Domain 1: General Security Concepts",
          question:
            "A risk assessment identifies a vulnerability with high impact but low likelihood. What should be the priority?",
          choices: [
            "Ignore it completely",
            "Implement expensive controls immediately",
            "Monitor and plan mitigation",
            "Transfer all risk via insurance",
          ],
          answer: 2,
          hint: "Balance impact against probability.",
          explanation:
            "High impact, low likelihood risks should be monitored and have mitigation plans ready, without over-investing in immediate expensive controls.",
        },

        // =====================================================
        // DOMAIN 2: Threats, Vulnerabilities, and Mitigations (6 questions)
        // =====================================================
        {
          id: "D2-Q1",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "A text message pretends to be IT support and asks for your password. What attack is this?",
          choices: ["Phishing", "Vishing", "Smishing", "Pretexting"],
          answer: 2,
          hint: "Channel matters: SMS vs. email vs. phone.",
          explanation:
            "Smishing uses SMS messages to trick users into divulging sensitive information or clicking malicious links.",
        },
        {
          id: "D2-Q2",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which malware encrypts data and demands payment for decryption?",
          choices: ["Trojan", "Ransomware", "Rootkit", "Worm"],
          answer: 1,
          hint: "Think extortion for data recovery.",
          explanation:
            "Ransomware encrypts files and demands payment (usually cryptocurrency) for the decryption key to restore access.",
        },
        {
          id: "D2-Q3",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which mitigation best reduces the impact of successful ransomware?",
          choices: [
            "Antivirus signatures",
            "Daily tested offline backups",
            "Port knocking",
            "Steganography detection",
          ],
          answer: 1,
          hint: "Focus on recovery even if prevention fails.",
          explanation:
            "Regular, tested offline backups enable recovery without paying attackers, as encrypted data can be restored from clean backups.",
        },
        {
          id: "D2-Q4",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "An attacker calls pretending to be from the bank's fraud department asking for account verification. This is:",
          choices: ["Smishing", "Vishing", "Whaling", "Watering hole"],
          answer: 1,
          hint: "Voice + phishing = ?",
          explanation:
            "Vishing (voice phishing) uses phone calls to impersonate legitimate organizations and trick victims into revealing sensitive information.",
        },
        {
          id: "D2-Q5",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "What type of attack injects malicious code into a trusted website visited by the target?",
          choices: [
            "SQL injection",
            "Cross-site scripting",
            "Watering hole",
            "Buffer overflow",
          ],
          answer: 2,
          hint: "Think about compromising a site that targets frequent.",
          explanation:
            "Watering hole attacks compromise websites frequently visited by targets, then use the trusted site to deliver malware to visitors.",
        },
        {
          id: "D2-Q6",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which vulnerability allows an attacker to execute database commands through web input?",
          choices: ["XSS", "CSRF", "SQL injection", "Directory traversal"],
          answer: 2,
          hint: "Think about database queries and user input.",
          explanation:
            "SQL injection occurs when user input is not properly sanitized, allowing attackers to execute arbitrary SQL commands against the database.",
        },

        // =====================================================
        // DOMAIN 3: Security Architecture (6 questions)
        // =====================================================
        {
          id: "D3-Q1",
          domain: "Domain 3: Security Architecture",
          question:
            "Layering multiple controls so one failure doesn't expose everything is known as:",
          choices: [
            "Zero Trust",
            "Defense in Depth",
            "Least Privilege",
            "Network Address Translation",
          ],
          answer: 1,
          hint: "Think 'backup plans' for security controls.",
          explanation:
            "Defense in Depth stacks multiple security controls (firewalls, IDS/IPS, MFA, monitoring) so if one fails, others provide protection.",
        },
        {
          id: "D3-Q2",
          domain: "Domain 3: Security Architecture",
          question:
            "In cloud shared responsibility, who secures customer data stored in S3?",
          choices: [
            "Cloud provider only",
            "Customer only",
            "Both: provider data, customer infra",
            "Both: provider infra, customer data/config",
          ],
          answer: 3,
          hint: "Provider secures the cloud; you secure what you put in it.",
          explanation:
            "Provider secures underlying infrastructure and physical security; the customer secures their data, configurations, and access controls.",
        },
        {
          id: "D3-Q3",
          domain: "Domain 3: Security Architecture",
          question:
            "Which approach most closely aligns with 'never trust, always verify'?",
          choices: [
            "Implicit trust",
            "Air gapping",
            "Zero Trust",
            "Perimeter-only security",
          ],
          answer: 2,
          hint: "Assume breach and verify each request.",
          explanation:
            "Zero Trust assumes no implicit trust; every user and device must be verified and authorized for each access request, regardless of location.",
        },
        {
          id: "D3-Q4",
          domain: "Domain 3: Security Architecture",
          question: "What is the primary purpose of network segmentation?",
          choices: [
            "Increase bandwidth",
            "Reduce broadcast domains",
            "Limit lateral movement",
            "Simplify routing",
          ],
          answer: 2,
          hint: "Think about containing threats that get inside.",
          explanation:
            "Network segmentation limits lateral movement by isolating different network zones, preventing attackers from easily moving between systems.",
        },
        {
          id: "D3-Q5",
          domain: "Domain 3: Security Architecture",
          question:
            "Which technology creates secure tunnels over untrusted networks?",
          choices: ["VLAN", "VPN", "VSAN", "CDN"],
          answer: 1,
          hint: "Think about remote access and encryption.",
          explanation:
            "VPN (Virtual Private Network) creates encrypted tunnels over untrusted networks like the internet, ensuring secure remote access.",
        },
        {
          id: "D3-Q6",
          domain: "Domain 3: Security Architecture",
          question:
            "In a DMZ architecture, where should a web server be placed?",
          choices: [
            "Internal network",
            "External network",
            "DMZ/screened subnet",
            "Management network",
          ],
          answer: 2,
          hint: "Think about public-facing services that need protection.",
          explanation:
            "Web servers should be placed in the DMZ (demilitarized zone), providing public access while isolating them from the internal network.",
        },

        // =====================================================
        // DOMAIN 4: Security Operations (6 questions)
        // =====================================================
        {
          id: "D4-Q1",
          domain: "Domain 4: Security Operations",
          question:
            "Which incident response phase isolates affected systems to prevent spread?",
          choices: ["Identification", "Containment", "Eradication", "Recovery"],
          answer: 1,
          hint: "Stop the bleeding before cleanup.",
          explanation:
            "Containment phase limits damage and prevents lateral movement by isolating affected systems from the rest of the network.",
        },
        {
          id: "D4-Q2",
          domain: "Domain 4: Security Operations",
          question:
            "A SIEM flags unusual outbound traffic at 03:00 from a workstation. Best immediate action?",
          choices: [
            "Reimage immediately",
            "Power off the SIEM",
            "Isolate the host from network",
            "Ignore as false positive",
          ],
          answer: 2,
          hint: "Limit impact while preserving evidence.",
          explanation:
            "Isolate first to contain potential compromise, then investigate. This preserves evidence while preventing further damage or data exfiltration.",
        },
        {
          id: "D4-Q3",
          domain: "Domain 4: Security Operations",
          question:
            "Which is critical for preserving legal admissibility of digital evidence?",
          choices: [
            "Full disk encryption",
            "Chain of custody",
            "File compression",
            "Log rotation",
          ],
          answer: 1,
          hint: "Documentation of who handled what, when.",
          explanation:
            "Chain of custody documents who collected, handled, transferred, and stored evidence, ensuring legal admissibility in court proceedings.",
        },
        {
          id: "D4-Q4",
          domain: "Domain 4: Security Operations",
          question: "What does a vulnerability scanner primarily identify?",
          choices: [
            "Active attacks",
            "System weaknesses",
            "Network traffic",
            "User behavior",
          ],
          answer: 1,
          hint: "Think about finding potential security holes.",
          explanation:
            "Vulnerability scanners identify system weaknesses, missing patches, misconfigurations, and known vulnerabilities that could be exploited.",
        },
        {
          id: "D4-Q5",
          domain: "Domain 4: Security Operations",
          question:
            "Which log source is most valuable for detecting lateral movement?",
          choices: [
            "Firewall logs",
            "Authentication logs",
            "Application logs",
            "DNS logs",
          ],
          answer: 1,
          hint: "Think about users accessing multiple systems.",
          explanation:
            "Authentication logs show user logins across different systems, helping detect unusual patterns that indicate lateral movement by attackers.",
        },
        {
          id: "D4-Q6",
          domain: "Domain 4: Security Operations",
          question: "What is the primary difference between IDS and IPS?",
          choices: [
            "IDS prevents, IPS detects",
            "IDS detects, IPS prevents",
            "IDS is hardware, IPS is software",
            "No difference",
          ],
          answer: 1,
          hint: "Think about active vs. passive response.",
          explanation:
            "IDS (Intrusion Detection System) detects and alerts on threats, while IPS (Intrusion Prevention System) actively blocks or prevents attacks.",
        },

        // =====================================================
        // DOMAIN 5: Security Program Management and Oversight (6 questions)
        // =====================================================
        {
          id: "D5-Q1",
          domain: "Domain 5: Security Program Management and Oversight",
          question: "Which US regulation protects healthcare PHI?",
          choices: ["SOX", "HIPAA", "GDPR", "ISO 27001"],
          answer: 1,
          hint: "Think hospitals and medical records.",
          explanation:
            "HIPAA (Health Insurance Portability and Accountability Act) governs protection and privacy of health information in the US healthcare industry.",
        },
        {
          id: "D5-Q2",
          domain: "Domain 5: Security Program Management and Oversight",
          question: "An RTO of 4 hours for a database means:",
          choices: [
            "Max data loss is 4 hours",
            "Restore service within 4 hours",
            "Backups must run every 4 hours",
            "No downtime over 4 hours per year",
          ],
          answer: 1,
          hint: "Time to restore service vs. data loss tolerance.",
          explanation:
            "RTO (Recovery Time Objective) is the maximum acceptable downtime; service should be restored within 4 hours of an incident.",
        },
        {
          id: "D5-Q3",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "What is the main purpose of a BIA (Business Impact Analysis)?",
          choices: [
            "Identify threats",
            "Calculate insurance costs",
            "Determine criticality of business processes",
            "Test backup systems",
          ],
          answer: 2,
          hint: "Think about which business functions are most important.",
          explanation:
            "BIA identifies and prioritizes critical business processes, determining the impact of disruptions to guide disaster recovery planning.",
        },
        {
          id: "D5-Q4",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which risk response strategy involves purchasing cyber insurance?",
          choices: [
            "Risk avoidance",
            "Risk mitigation",
            "Risk transfer",
            "Risk acceptance",
          ],
          answer: 2,
          hint: "Think about shifting financial responsibility.",
          explanation:
            "Risk transfer shifts the financial impact of risks to a third party, such as through insurance policies or outsourcing arrangements.",
        },
        {
          id: "D5-Q5",
          domain: "Domain 5: Security Program Management and Oversight",
          question: "What does RPO (Recovery Point Objective) measure?",
          choices: [
            "Time to restore systems",
            "Maximum acceptable data loss",
            "Cost of downtime",
            "Frequency of backups",
          ],
          answer: 1,
          hint: "Think about how much data you can afford to lose.",
          explanation:
            "RPO measures the maximum acceptable amount of data loss measured in time (e.g., lose no more than 1 hour of data).",
        },
        {
          id: "D5-Q6",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which framework provides guidelines for IT governance and management?",
          choices: ["NIST", "COBIT", "ITIL", "TOGAF"],
          answer: 1,
          hint: "Think about control objectives for IT.",
          explanation:
            "COBIT (Control Objectives for Information Technologies) provides a framework for IT governance, management, and control processes.",
        },

        {
          id: "D4-Q30",
          domain: "Domain 4: Security Operations",
          question:
            "Which practice ensures mobile devices are configured with secure settings before deployment?",
          choices: [
            "Hardening",
            "Sandboxing",
            "Virtualization",
            "Provisioning",
          ],
          answer: 0,
          hint: "Think about disabling unnecessary services and applying baselines.",
          explanation:
            "Hardening applies secure baselines and removes unnecessary apps/services to reduce the attack surface.",
        },
        {
          id: "D4-Q31",
          domain: "Domain 4: Security Operations",
          question:
            "What is the purpose of sandboxing in application security?",
          choices: [
            "Encrypting application traffic",
            "Running apps in isolated environments",
            "Detecting SQL injection attacks",
            "Monitoring file integrity",
          ],
          answer: 1,
          hint: "Think about isolation.",
          explanation:
            "Sandboxing isolates applications to prevent malicious code from affecting the host system.",
        },
        {
          id: "D4-Q32",
          domain: "Domain 4: Security Operations",
          question:
            "Which wireless security protocol is most secure today for enterprise environments?",
          choices: ["WEP", "WPA", "WPA2", "WPA3"],
          answer: 3,
          hint: "Think of the latest standard.",
          explanation:
            "WPA3 provides the strongest wireless encryption and authentication methods available for enterprises.",
        },
        {
          id: "D4-Q33",
          domain: "Domain 4: Security Operations",
          question: "What is the FIRST step in secure asset disposal?",
          choices: [
            "Shredding drives",
            "Data wiping",
            "Inventory check",
            "Decommissioning",
          ],
          answer: 2,
          hint: "Start with documentation.",
          explanation:
            "An inventory check ensures assets are properly accounted for before applying destruction or wiping.",
        },
        {
          id: "D4-Q34",
          domain: "Domain 4: Security Operations",
          question:
            "Which tool BEST detects vulnerabilities before attackers can exploit them?",
          choices: [
            "File Integrity Monitoring",
            "Vulnerability Scanner",
            "Intrusion Detection System",
            "SIEM",
          ],
          answer: 1,
          hint: "It finds weak spots before exploitation.",
          explanation:
            "Vulnerability scanners analyze systems for missing patches and misconfigurations before exploitation.",
        },
        {
          id: "D4-Q35",
          domain: "Domain 4: Security Operations",
          question:
            "Which step follows remediation in the vulnerability management lifecycle?",
          choices: ["Reporting", "Validation", "Scanning", "Acquisition"],
          answer: 1,
          hint: "You need to verify fixes.",
          explanation:
            "Validation ensures that remediation steps successfully eliminated the vulnerabilities.",
        },
        {
          id: "D4-Q36",
          domain: "Domain 4: Security Operations",
          question:
            "Which monitoring tool is MOST likely to collect and analyze log data?",
          choices: ["NAC", "SIEM", "EDR", "Firewall"],
          answer: 1,
          hint: "Think centralized log correlation.",
          explanation:
            "SIEM systems collect logs, correlate events, and generate alerts for potential threats.",
        },
        {
          id: "D4-Q37",
          domain: "Domain 4: Security Operations",
          question:
            "What is the PRIMARY purpose of NAC (Network Access Control)?",
          choices: [
            "Preventing phishing attacks",
            "Ensuring only compliant devices connect",
            "Encrypting Wi-Fi traffic",
            "Blocking SQL injection",
          ],
          answer: 1,
          hint: "Think endpoint compliance before access.",
          explanation:
            "NAC ensures only trusted and compliant devices can connect to the network.",
        },
        {
          id: "D4-Q38",
          domain: "Domain 4: Security Operations",
          question:
            "Which identity management technique allows a user to log in once and access multiple systems?",
          choices: ["MFA", "SSO", "RBAC", "Least Privilege"],
          answer: 1,
          hint: "One login for many systems.",
          explanation:
            "Single Sign-On (SSO) allows users to authenticate once and access multiple applications seamlessly.",
        },
        {
          id: "D4-Q39",
          domain: "Domain 4: Security Operations",
          question:
            "Which factor combination provides strong multifactor authentication?",
          choices: [
            "Password + PIN",
            "Fingerprint + Smartcard",
            "Password + Security Question",
            "PIN + Password",
          ],
          answer: 1,
          hint: "Think different categories: something you know, have, or are.",
          explanation:
            "Fingerprint (something you are) and smartcard (something you have) make a strong MFA combination.",
        },
        {
          id: "D4-Q40",
          domain: "Domain 4: Security Operations",
          question:
            "Which scripting benefit helps reduce human error in security operations?",
          choices: ["Automation", "Sandboxing", "Encryption", "Obfuscation"],
          answer: 0,
          hint: "Think about repeatable tasks.",
          explanation:
            "Automation reduces repetitive manual tasks, lowering the chance of human error.",
        },
        {
          id: "D4-Q41",
          domain: "Domain 4: Security Operations",
          question:
            "Which phase of incident response involves identifying the root cause?",
          choices: [
            "Preparation",
            "Containment",
            "Eradication",
            "Lessons Learned",
          ],
          answer: 3,
          hint: "This comes after recovery.",
          explanation:
            "Lessons Learned includes root cause analysis and improving processes to prevent future incidents.",
        },
        {
          id: "D4-Q42",
          domain: "Domain 4: Security Operations",
          question: "What is the FIRST step in an incident response plan?",
          choices: ["Preparation", "Detection", "Containment", "Recovery"],
          answer: 0,
          hint: "Before anything happens, you must plan.",
          explanation:
            "Preparation ensures processes, tools, and teams are ready to respond to incidents effectively.",
        },
        {
          id: "D4-Q43",
          domain: "Domain 4: Security Operations",
          question:
            "Which type of forensics focuses on collecting volatile memory data?",
          choices: [
            "Network Forensics",
            "Host Forensics",
            "Memory Forensics",
            "Disk Forensics",
          ],
          answer: 2,
          hint: "Think RAM.",
          explanation:
            "Memory forensics captures and analyzes RAM to detect malware and live threats.",
        },
        {
          id: "D4-Q44",
          domain: "Domain 4: Security Operations",
          question:
            "Which log source BEST helps detect brute force login attempts?",
          choices: [
            "Firewall Logs",
            "Authentication Logs",
            "DNS Logs",
            "Application Logs",
          ],
          answer: 1,
          hint: "Think login activity.",
          explanation:
            "Authentication logs record login attempts, making brute force detection possible.",
        },
        {
          id: "D4-Q45",
          domain: "Domain 4: Security Operations",
          question:
            "Which security control detects and blocks malicious network traffic in real time?",
          choices: ["IDS", "IPS", "Firewall", "SIEM"],
          answer: 1,
          hint: "Think detection AND prevention.",
          explanation:
            "Intrusion Prevention Systems (IPS) actively block malicious network activity in real time.",
        },
        {
          id: "D4-Q46",
          domain: "Domain 4: Security Operations",
          question:
            "Which type of baseline ensures a consistent and secure system configuration?",
          choices: [
            "Performance Baseline",
            "Secure Baseline",
            "Operational Baseline",
            "Change Baseline",
          ],
          answer: 1,
          hint: "Think security hardening.",
          explanation:
            "A secure baseline standardizes system configurations with security best practices applied.",
        },
        {
          id: "D4-Q47",
          domain: "Domain 4: Security Operations",
          question:
            "Which type of analysis involves looking for unusual behavior in logs?",
          choices: [
            "Signature-Based Detection",
            "Behavioral Analysis",
            "Packet Filtering",
            "Data Masking",
          ],
          answer: 1,
          hint: "Not signatures, but behaviors.",
          explanation:
            "Behavioral analysis identifies suspicious patterns deviating from normal activity.",
        },
        {
          id: "D4-Q48",
          domain: "Domain 4: Security Operations",
          question:
            "What is the MAIN advantage of using EDR over traditional antivirus?",
          choices: [
            "Detects only known threats",
            "Focuses solely on signatures",
            "Provides continuous monitoring and response",
            "Scans emails for spam",
          ],
          answer: 2,
          hint: "Think extended detection.",
          explanation:
            "Endpoint Detection and Response (EDR) offers advanced detection, continuous monitoring, and automated response.",
        },
        {
          id: "D4-Q49",
          domain: "Domain 4: Security Operations",
          question:
            "Which data loss prevention (DLP) control prevents sensitive files from leaving the network?",
          choices: [
            "Content Filtering",
            "Email Encryption",
            "Firewall Rule",
            "Endpoint Encryption",
          ],
          answer: 0,
          hint: "Think blocking data exfiltration.",
          explanation:
            "DLP content filtering inspects and blocks unauthorized transmission of sensitive data.",
        },
        {
          id: "D4-Q50",
          domain: "Domain 4: Security Operations",
          question:
            "Which scripting language is MOST often used in Windows environments for automation?",
          choices: ["Bash", "Python", "PowerShell", "Perl"],
          answer: 2,
          hint: "Think Microsoft native.",
          explanation:
            "PowerShell is a Windows-native scripting language widely used for automation and security tasks.",
        },
        {
          id: "D4-Q51",
          domain: "Domain 4: Security Operations",
          question: "Which log source BEST detects DNS tunneling activity?",
          choices: [
            "Authentication Logs",
            "DNS Logs",
            "Firewall Logs",
            "Web Server Logs",
          ],
          answer: 1,
          hint: "Think about unusual queries.",
          explanation:
            "DNS logs help detect suspicious patterns like long or abnormal domain queries indicating tunneling.",
        },
        {
          id: "D4-Q52",
          domain: "Domain 4: Security Operations",
          question:
            "Which enterprise tool combines threat detection with automated response?",
          choices: ["SIEM", "NAC", "XDR", "Firewall"],
          answer: 2,
          hint: "Think extended detection and response.",
          explanation:
            "XDR extends EDR to multiple layers, integrating threat detection and automated responses across systems.",
        },
        {
          id: "D4-Q53",
          domain: "Domain 4: Security Operations",
          question:
            "Which type of malware analysis runs code in a safe virtual environment?",
          choices: [
            "Static Analysis",
            "Dynamic Analysis",
            "Packet Analysis",
            "File Hashing",
          ],
          answer: 1,
          hint: "Think execution in isolation.",
          explanation:
            "Dynamic analysis observes malware behavior by executing it in a sandboxed virtual environment.",
        },
        {
          id: "D4-Q54",
          domain: "Domain 4: Security Operations",
          question:
            "Which process ensures that patches are tested and deployed without disrupting operations?",
          choices: [
            "Vulnerability Scanning",
            "Patch Management",
            "Incident Response",
            "Penetration Testing",
          ],
          answer: 1,
          hint: "Think lifecycle of software updates.",
          explanation:
            "Patch management ensures timely testing, deployment, and validation of patches to maintain security.",
        },
        {
          id: "D4-Q55",
          domain: "Domain 4: Security Operations",
          question: "What is the PRIMARY purpose of digital forensics?",
          choices: [
            "Recovering deleted emails",
            "Preserving evidence for investigation",
            "Detecting insider threats",
            "Scanning system vulnerabilities",
          ],
          answer: 1,
          hint: "Think legal admissibility.",
          explanation:
            "Digital forensics collects, preserves, and analyzes evidence for investigations and legal proceedings.",
        },
        {
          id: "D4-Q56",
          domain: "Domain 4: Security Operations",
          question:
            "Which type of script is MOST likely to be used for Linux server automation?",
          choices: [
            "Batch Script",
            "Bash Script",
            "PowerShell Script",
            "VBScript",
          ],
          answer: 1,
          hint: "Think Linux native shell.",
          explanation:
            "Bash scripts automate tasks on Linux servers for security and administrative operations.",
        },
        {
          id: "D4-Q57",
          domain: "Domain 4: Security Operations",
          question:
            "Which security principle limits admin privileges only to what is necessary?",
          choices: [
            "Least Privilege",
            "Need to Know",
            "Separation of Duties",
            "MFA",
          ],
          answer: 0,
          hint: "Think minimal access rights.",
          explanation:
            "Least Privilege grants only the permissions required, reducing attack surface and misuse risks.",
        },
        {
          id: "D4-Q58",
          domain: "Domain 4: Security Operations",
          question:
            "Which enterprise security tool filters malicious or unwanted domains?",
          choices: ["DNS Filtering", "EDR", "SIEM", "Firewall"],
          answer: 0,
          hint: "Think web reputation control.",
          explanation:
            "DNS filtering blocks access to malicious or restricted domains, reducing risk of phishing and malware.",
        },
        {
          id: "D4-Q59",
          domain: "Domain 4: Security Operations",
          question:
            "What is the MAIN benefit of automation in incident response?",
          choices: [
            "Eliminates all human involvement",
            "Speeds up containment and response",
            "Removes need for security training",
            "Guarantees no breaches occur",
          ],
          answer: 1,
          hint: "Think efficiency.",
          explanation:
            "Automation speeds up containment and remediation tasks, reducing attacker dwell time.",
        },

        {
          id: "D5-Q60",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which document provides high-level direction for an organization's security program?",
          choices: ["Procedure", "Policy", "Standard", "Guideline"],
          answer: 1,
          hint: "Think about overarching rules, not technical details.",
          explanation:
            "A policy defines management’s intent and provides overall guidance for the security program.",
        },
        {
          id: "D5-Q61",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which governance structure is responsible for aligning security with business goals?",
          choices: [
            "Change Advisory Board",
            "Security Steering Committee",
            "Incident Response Team",
            "Audit Committee",
          ],
          answer: 1,
          hint: "Think executive-level oversight.",
          explanation:
            "A Security Steering Committee ensures that security initiatives align with business strategy.",
        },
        {
          id: "D5-Q62",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which document provides step-by-step instructions for carrying out specific security tasks?",
          choices: ["Policy", "Procedure", "Standard", "Guideline"],
          answer: 1,
          hint: "Think operational detail.",
          explanation:
            "Procedures define specific instructions for implementing policies and standards.",
        },
        {
          id: "D5-Q63",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which risk management term refers to the amount of risk an organization is willing to accept?",
          choices: [
            "Risk Register",
            "Risk Appetite",
            "Risk Tolerance",
            "Risk Transfer",
          ],
          answer: 1,
          hint: "Think strategy, not limit.",
          explanation:
            "Risk appetite defines the broad amount of risk an organization is willing to accept to achieve goals.",
        },
        {
          id: "D5-Q64",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which document lists and tracks identified risks and their mitigation status?",
          choices: [
            "Risk Appetite Statement",
            "Risk Register",
            "BIA",
            "Audit Report",
          ],
          answer: 1,
          hint: "Think of a database for risks.",
          explanation:
            "A risk register records identified risks, assessments, owners, and remediation progress.",
        },
        {
          id: "D5-Q65",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which risk management activity prioritizes critical systems and processes for recovery?",
          choices: [
            "Risk Assessment",
            "Business Impact Analysis (BIA)",
            "Risk Mitigation",
            "Risk Reporting",
          ],
          answer: 1,
          hint: "Think disaster recovery planning.",
          explanation:
            "A Business Impact Analysis determines the criticality of systems and the impact of disruptions.",
        },
        {
          id: "D5-Q66",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which third-party risk activity ensures vendors meet security requirements before onboarding?",
          choices: [
            "Continuous Monitoring",
            "Vendor Selection and Assessment",
            "Rules of Engagement",
            "Attestation",
          ],
          answer: 1,
          hint: "Think evaluation before contracts.",
          explanation:
            "Vendor selection and assessment evaluate third parties before establishing agreements.",
        },
        {
          id: "D5-Q67",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which agreement defines the responsibilities and expectations between an organization and a vendor?",
          choices: ["MOU", "SLA", "NDA", "Rules of Engagement"],
          answer: 1,
          hint: "Think service performance guarantees.",
          explanation:
            "Service Level Agreements (SLAs) define expected performance, uptime, and responsibilities.",
        },
        {
          id: "D5-Q68",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which compliance issue may result from failing to meet GDPR requirements?",
          choices: [
            "Reduced Productivity",
            "Financial Penalties",
            "Longer Downtime",
            "Poor SLA Performance",
          ],
          answer: 1,
          hint: "Think legal consequences.",
          explanation:
            "Non-compliance with privacy regulations like GDPR can result in significant financial fines.",
        },
        {
          id: "D5-Q69",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which type of audit is conducted by independent external parties?",
          choices: [
            "Internal Audit",
            "Compliance Monitoring",
            "External Audit",
            "Self-Assessment",
          ],
          answer: 2,
          hint: "Think independent review.",
          explanation:
            "External audits are conducted by third-party firms to provide independent validation of compliance.",
        },
        {
          id: "D5-Q70",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which assessment involves simulating an attacker to test defenses?",
          choices: [
            "Risk Assessment",
            "Penetration Test",
            "Vulnerability Scan",
            "Audit",
          ],
          answer: 1,
          hint: "Think real-world attack simulation.",
          explanation:
            "Penetration testing simulates adversarial techniques to identify exploitable weaknesses.",
        },
        {
          id: "D5-Q71",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which security awareness training topic focuses on identifying suspicious login activity?",
          choices: [
            "Phishing Emails",
            "Anomalous Behavior Recognition",
            "Password Reuse",
            "Patch Management",
          ],
          answer: 1,
          hint: "Think user spotting unusual activity.",
          explanation:
            "Awareness training helps users detect anomalous behavior, such as unusual login attempts.",
        },
        {
          id: "D5-Q72",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which governance document typically defines technical configurations such as encryption strength?",
          choices: ["Policies", "Standards", "Procedures", "Guidelines"],
          answer: 1,
          hint: "Think measurable technical requirement.",
          explanation:
            "Standards define technical specifics like key length or password complexity.",
        },
        {
          id: "D5-Q73",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which role is MOST responsible for ensuring compliance with security policies?",
          choices: ["End Users", "Security Officers", "Auditors", "Executives"],
          answer: 1,
          hint: "Think daily enforcement.",
          explanation:
            "Security Officers oversee enforcement and compliance with policies across the organization.",
        },
        {
          id: "D5-Q74",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which risk response strategy involves purchasing cyber insurance?",
          choices: [
            "Risk Acceptance",
            "Risk Avoidance",
            "Risk Mitigation",
            "Risk Transfer",
          ],
          answer: 3,
          hint: "Think shifting responsibility.",
          explanation:
            "Risk transfer shifts financial impact to a third party, such as via cyber insurance.",
        },
        {
          id: "D5-Q75",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which process ensures vendors are continuously monitored for compliance?",
          choices: [
            "Vendor Assessment",
            "Ongoing Vendor Monitoring",
            "Due Diligence",
            "Audit",
          ],
          answer: 1,
          hint: "Think post-contract activities.",
          explanation:
            "Ongoing monitoring ensures vendors remain compliant throughout the relationship.",
        },
        {
          id: "D5-Q76",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which compliance activity validates that employees follow privacy rules?",
          choices: [
            "User Awareness",
            "Monitoring",
            "Risk Assessment",
            "Vendor Selection",
          ],
          answer: 1,
          hint: "Think observation and checks.",
          explanation:
            "Monitoring ensures employees comply with privacy rules and organizational policies.",
        },
        {
          id: "D5-Q77",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which audit document confirms that a third-party security process is effective?",
          choices: ["SOC Report", "Risk Register", "SLA", "BIA"],
          answer: 0,
          hint: "Think service organization controls.",
          explanation:
            "SOC reports validate that a third-party's controls are designed and operating effectively.",
        },
        {
          id: "D5-Q78",
          domain: "Domain 5: Security Program Management and Oversight",
          question:
            "Which security awareness training method BEST tests user susceptibility to phishing?",
          choices: [
            "Policy Review",
            "Phishing Simulations",
            "Password Training",
            "Workshops",
          ],
          answer: 1,
          hint: "Think practical exercises.",
          explanation:
            "Phishing simulations test real-world user responses to fake phishing attempts.",
        },

        {
          id: "D2-Q79",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which threat actor is MOST likely motivated by political or ideological goals?",
          choices: [
            "Hacktivists",
            "Nation-States",
            "Insider Threats",
            "Organized Crime",
          ],
          answer: 0,
          hint: "Think activism online.",
          explanation:
            "Hacktivists use hacking to promote political or social causes rather than financial gain.",
        },
        {
          id: "D2-Q80",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which threat actor typically has the most resources and capabilities?",
          choices: [
            "Script Kiddies",
            "Nation-States",
            "Hacktivists",
            "Organized Crime",
          ],
          answer: 1,
          hint: "Think cyber warfare and espionage.",
          explanation:
            "Nation-states have extensive resources, advanced tools, and long-term strategic motivations.",
        },
        {
          id: "D2-Q81",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which insider threat is MOST dangerous?",
          choices: [
            "Disgruntled Employee",
            "Accidental Insider",
            "Shadow IT User",
            "External Vendor",
          ],
          answer: 0,
          hint: "Think malicious intent with authorized access.",
          explanation:
            "A disgruntled employee with legitimate access can deliberately exfiltrate or sabotage systems.",
        },
        {
          id: "D2-Q82",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "What is the PRIMARY motivation for organized crime cyberattacks?",
          choices: ["Espionage", "Financial Gain", "Activism", "Revenge"],
          answer: 1,
          hint: "Think profit-driven.",
          explanation:
            "Organized crime groups focus on ransomware, fraud, and theft for financial gain.",
        },
        {
          id: "D2-Q83",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which attack vector exploits weaknesses in human psychology?",
          choices: [
            "File-Based",
            "Social Engineering",
            "Supply Chain",
            "Network-Based",
          ],
          answer: 1,
          hint: "Think manipulation, not code.",
          explanation:
            "Social engineering manipulates people into revealing information or bypassing security controls.",
        },
        {
          id: "D2-Q84",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which attack vector is MOST associated with phishing?",
          choices: [
            "Message-Based",
            "File-Based",
            "Voice Call",
            "Supply Chain",
          ],
          answer: 0,
          hint: "Think email links and attachments.",
          explanation:
            "Message-based vectors like email are primary methods for phishing and spear phishing attacks.",
        },
        {
          id: "D2-Q85",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which vulnerability is MOST often exploited through buffer overflow?",
          choices: [
            "Cloud-Specific",
            "Application",
            "Virtualization",
            "Hardware",
          ],
          answer: 1,
          hint: "Think coding flaws.",
          explanation:
            "Application vulnerabilities such as poor input validation lead to buffer overflow exploits.",
        },
        {
          id: "D2-Q86",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which vulnerability is tied to unpatched hypervisors?",
          choices: ["Hardware", "Virtualization", "Web-Based", "Supply Chain"],
          answer: 1,
          hint: "Think virtual machines.",
          explanation:
            "Virtualization vulnerabilities stem from flaws in hypervisors that manage virtual machines.",
        },
        {
          id: "D2-Q87",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which vulnerability MOST affects smartphones and tablets?",
          choices: ["Cloud-Specific", "Mobile Device", "Hardware", "Web-Based"],
          answer: 1,
          hint: "Think iOS and Android devices.",
          explanation:
            "Mobile device vulnerabilities include insecure apps, jailbreaking, and weak configurations.",
        },
        {
          id: "D2-Q88",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which attack involves malicious updates or tampered components entering the software lifecycle?",
          choices: [
            "Phishing",
            "Supply Chain Attack",
            "Password Attack",
            "Brute Force",
          ],
          answer: 1,
          hint: "Think compromised trusted sources.",
          explanation:
            "Supply chain attacks compromise trusted vendors or updates to distribute malware.",
        },
        {
          id: "D2-Q89",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which type of malware encrypts files and demands payment?",
          choices: ["Trojan", "Worm", "Ransomware", "Rootkit"],
          answer: 2,
          hint: "Think extortion.",
          explanation:
            "Ransomware encrypts victim files and demands payment for the decryption key.",
        },
        {
          id: "D2-Q90",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which password attack uses a precomputed list of hashes?",
          choices: [
            "Brute Force",
            "Dictionary Attack",
            "Rainbow Table Attack",
            "Phishing",
          ],
          answer: 2,
          hint: "Think precomputed values.",
          explanation:
            "Rainbow table attacks use precomputed hash lists to quickly crack passwords.",
        },
        {
          id: "D2-Q91",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which attack floods a system with traffic to make it unavailable?",
          choices: [
            "Man-in-the-Middle",
            "DoS/DDoS",
            "SQL Injection",
            "Brute Force",
          ],
          answer: 1,
          hint: "Think overwhelming bandwidth.",
          explanation:
            "Denial-of-Service (DoS) and Distributed DoS (DDoS) overwhelm systems with traffic to disrupt availability.",
        },
        {
          id: "D2-Q92",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which cryptographic attack attempts to find two different inputs with the same hash?",
          choices: [
            "Birthday Attack",
            "Replay Attack",
            "Side-Channel Attack",
            "Brute Force",
          ],
          answer: 0,
          hint: "Think probability in hashing.",
          explanation:
            "Birthday attacks exploit hash function weaknesses to find collisions between inputs.",
        },
        {
          id: "D2-Q93",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which mitigation technique limits damage by isolating network segments?",
          choices: [
            "Hardening",
            "Segmentation",
            "Access Control",
            "Patch Management",
          ],
          answer: 1,
          hint: "Think separating systems.",
          explanation:
            "Network segmentation isolates systems, reducing the spread of attacks across the network.",
        },
        {
          id: "D2-Q94",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which mitigation ensures only authorized users can access sensitive resources?",
          choices: ["Segmentation", "Isolation", "Access Control", "Hardening"],
          answer: 2,
          hint: "Think authentication and authorization.",
          explanation:
            "Access control enforces who can access what, preventing unauthorized access to resources.",
        },
        {
          id: "D2-Q95",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which mitigation technique involves disabling unused ports and services?",
          choices: ["Segmentation", "Isolation", "Hardening", "Patching"],
          answer: 2,
          hint: "Think reducing attack surface.",
          explanation:
            "Hardening minimizes vulnerabilities by disabling unnecessary services and applying secure baselines.",
        },
        {
          id: "D2-Q96",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question: "Which mitigation addresses zero-day vulnerabilities?",
          choices: [
            "Segmentation",
            "Patching",
            "Isolation",
            "Configuration Enforcement",
          ],
          answer: 1,
          hint: "Think software updates.",
          explanation:
            "Patching addresses vulnerabilities, including zero-days once fixes are released.",
        },
        {
          id: "D2-Q97",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which type of malware hides its presence by altering system processes?",
          choices: ["Worm", "Rootkit", "Trojan", "Spyware"],
          answer: 1,
          hint: "Think stealthy persistence.",
          explanation:
            "Rootkits modify system processes to hide malicious activity and maintain persistence.",
        },
        {
          id: "D2-Q98",
          domain: "Domain 2: Threats, Vulnerabilities, and Mitigations",
          question:
            "Which physical attack involves attaching a rogue device to intercept network traffic?",
          choices: [
            "Shoulder Surfing",
            "Skimming",
            "Evil Twin",
            "Rogue AP/Device",
          ],
          answer: 3,
          hint: "Think unauthorized hardware.",
          explanation:
            "Rogue devices inserted into networks can intercept, modify, or redirect traffic.",
        },
      ];

      // Shuffle questions for variety
      function shuffle(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      // State
      let questions = shuffle(QUESTIONS);
      let idx = 0;
      let attempts = 0; // attempts on current question
      let score = 0;
      const results = []; // {id, domain, correct, attempts}
      const perDomain = {}; // domain -> {correct, total}

      // Elements
      const progressText = document.getElementById("progressText");
      const scoreText = document.getElementById("scoreText");
      const progressBar = document.getElementById("progressBar");
      const domainBadge = document.getElementById("domainBadge");
      const questionText = document.getElementById("questionText");
      const optionsEl = document.getElementById("options");
      const feedback = document.getElementById("feedback");
      const feedbackInner = document.getElementById("feedbackInner");
      const nextBtn = document.getElementById("nextBtn");
      const revealBtn = document.getElementById("revealBtn");
      const resultsSection = document.getElementById("results");
      const finalScore = document.getElementById("finalScore");
      const domainBreakdown = document.getElementById("domainBreakdown");
      const restartBtn = document.getElementById("restartBtn");

      nextBtn.addEventListener("click", () => {
        idx++;
        if (idx >= questions.length) {
          showResults();
        } else {
          attempts = 0;
          render();
        }
      });

      revealBtn.addEventListener("click", () => {
        // Force show explanation & correct answer
        showExplanation(true);
      });

      restartBtn?.addEventListener("click", () => {
        questions = shuffle(QUESTIONS);
        idx = 0;
        attempts = 0;
        score = 0;
        Object.keys(perDomain).forEach((k) => delete perDomain[k]);
        results.length = 0;
        resultsSection.classList.add("hidden");
        document.getElementById("card").classList.remove("hidden");
        render();
      });

      function render() {
        const q = questions[idx];
        updateProgress();
        domainBadge.textContent = q.domain;

        // Color-code domain badges
        const domainColors = {
          "Domain 1: General Security Concepts": "bg-blue-50 text-blue-700",
          "Domain 2: Threats, Vulnerabilities, and Mitigations":
            "bg-red-50 text-red-700",
          "Domain 3: Security Architecture": "bg-green-50 text-green-700",
          "Domain 4: Security Operations": "bg-purple-50 text-purple-700",
          "Domain 5: Security Program Management and Oversight":
            "bg-yellow-50 text-yellow-700",
        };

        domainBadge.className = `inline-flex items-center text-xs font-semibold px-2.5 py-1 rounded-full ${
          domainColors[q.domain] || "bg-gray-50 text-gray-700"
        }`;

        questionText.textContent = q.question;
        feedback.classList.add("hidden");
        feedbackInner.innerHTML = "";
        nextBtn.disabled = true;
        revealBtn.classList.add("hidden");

        optionsEl.innerHTML = "";
        q.choices.forEach((choice, i) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className =
            "kb-focus text-left w-full px-4 py-3 rounded-xl border bg-white hover:bg-gray-50";
          btn.setAttribute("data-index", i);
          btn.setAttribute(
            "aria-label",
            `Answer option ${String.fromCharCode(65 + i)}: ${choice}`
          );
          btn.innerHTML = `<span class="font-semibold mr-2">${String.fromCharCode(
            65 + i
          )}.</span>${choice}`;
          btn.addEventListener("click", onSelect);
          optionsEl.appendChild(btn);
        });
      }

      function updateProgress() {
        const total = questions.length;
        progressText.textContent = `Question ${idx + 1} of ${total}`;
        scoreText.textContent = `Score: ${score}`;
        const pct = Math.round((idx / total) * 100);
        progressBar.style.width = `${pct}%`;
      }

      function onSelect(e) {
        const q = questions[idx];
        const selectedIdx = Number(e.currentTarget.getAttribute("data-index"));

        // If already resolved (next enabled), ignore further clicks
        if (!nextBtn.disabled) return;

        // First: mark the chosen button visually
        const buttons = [...optionsEl.querySelectorAll("button")];
        buttons.forEach((b) => b.classList.remove("ring-2", "ring-blue-400"));
        e.currentTarget.classList.add("ring-2", "ring-blue-400");

        if (selectedIdx === q.answer) {
          // Correct
          score++;
          lockOptions(selectedIdx, q.answer);
          showCorrect();
          recordResult(true);
          nextBtn.disabled = false;
        } else {
          // Incorrect
          attempts++;
          if (attempts === 1) {
            // Show hint, keep options enabled (disable the chosen wrong to guide)
            e.currentTarget.classList.add("opacity-60", "cursor-not-allowed");
            e.currentTarget.disabled = true;
            showHint(q.hint);
            revealBtn.classList.remove("hidden");
          } else {
            // Second miss => show explanation, reveal correct, lock
            lockOptions(selectedIdx, q.answer);
            showExplanation(false);
            recordResult(false);
            nextBtn.disabled = false;
          }
        }
      }

      function lockOptions(selectedIdx, correctIdx) {
        const buttons = [...optionsEl.querySelectorAll("button")];
        buttons.forEach((btn, i) => {
          btn.disabled = true;
          btn.classList.remove("hover:bg-gray-50", "ring-2", "ring-blue-400");
          if (i === correctIdx) {
            btn.classList.add("border-green-600", "bg-green-50");
          }
          if (i === selectedIdx && selectedIdx !== correctIdx) {
            btn.classList.add("border-red-600", "bg-red-50", "opacity-80");
          }
        });
      }

      function showHint(hint) {
        feedback.classList.remove("hidden");
        feedbackInner.className =
          "rounded-xl border border-yellow-300 bg-yellow-50 p-4";
        feedbackInner.innerHTML = `
        <div class="flex items-start gap-2">
          <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-yellow-200 text-yellow-900 text-xs font-bold">!</span>
          <div>
            <p class="font-semibold text-yellow-900">Hint</p>
            <p class="text-yellow-900/90 mt-1">${hint}</p>
            <p class="text-xs text-yellow-900/80 mt-2">Try again. You'll see the full explanation if you miss one more time.</p>
          </div>
        </div>
      `;
      }

      function showCorrect() {
        const q = questions[idx];
        feedback.classList.remove("hidden");
        feedbackInner.className =
          "rounded-xl border border-green-300 bg-green-50 p-4";
        feedbackInner.innerHTML = `
        <div class="flex items-start gap-2">
          <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-green-200 text-green-900 text-xs font-bold">✓</span>
          <div>
            <p class="font-semibold text-green-900">Correct</p>
            <p class="text-green-900/90 mt-1">${q.explanation}</p>
          </div>
        </div>
      `;
      }

      function showExplanation(forcedReveal) {
        const q = questions[idx];
        feedback.classList.remove("hidden");
        feedbackInner.className =
          "rounded-xl border border-red-300 bg-red-50 p-4";
        feedbackInner.innerHTML = `
        <div class="flex items-start gap-2">
          <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full bg-red-200 text-red-900 text-xs font-bold">×</span>
          <div>
            <p class="font-semibold text-red-900">${
              forcedReveal ? "Answer Revealed" : "Incorrect (2nd attempt)"
            }</p>
            <p class="text-red-900/90 mt-1"><span class="font-semibold">Correct answer:</span> ${String.fromCharCode(
              65 + q.answer
            )}. ${q.choices[q.answer]}</p>
            <p class="text-red-900/90 mt-2">${q.explanation}</p>
          </div>
        </div>
      `;

        // When forcing reveal (user clicked Reveal Answer), also lock options & enable next
        if (forcedReveal) {
          const buttons = [...optionsEl.querySelectorAll("button")];
          buttons.forEach((btn, i) => {
            btn.disabled = true;
            btn.classList.remove("hover:bg-gray-50", "ring-2", "ring-blue-400");
            if (i === q.answer)
              btn.classList.add("border-green-600", "bg-green-50");
          });
          nextBtn.disabled = false;

          // Only record as incorrect if not yet recorded and attempts == 0 or 1
          if (!results.some((r) => r.id === q.id)) {
            attempts = Math.max(attempts, 2);
            recordResult(false);
          }
        }
      }

      function recordResult(correct) {
        const q = questions[idx];
        results.push({ id: q.id, domain: q.domain, correct, attempts });
        perDomain[q.domain] = perDomain[q.domain] || { correct: 0, total: 0 };
        perDomain[q.domain].total += 1;
        if (correct) perDomain[q.domain].correct += 1;
      }

      function showResults() {
        // Fill progress bar to 100%
        progressBar.style.width = "100%";
        document.getElementById("card").classList.add("hidden");
        resultsSection.classList.remove("hidden");

        finalScore.textContent = `You answered ${score} out of ${
          questions.length
        } correctly (${Math.round((score / questions.length) * 100)}%).`;

        domainBreakdown.innerHTML = "";
        Object.keys(perDomain).forEach((domain) => {
          const d = perDomain[domain];
          const pct = Math.round((d.correct / d.total) * 100);
          const card = document.createElement("div");
          card.className = "rounded-xl border p-4";

          // Shorten domain names for display
          const shortDomain = domain
            .replace("Domain ", "D")
            .replace(": ", " - ");

          card.innerHTML = `
          <p class="font-semibold text-sm">${shortDomain}</p>
          <p class="text-gray-700 mt-1">${d.correct} / ${
            d.total
          } correct (${pct}%)</p>
          <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
            <div class="${
              pct >= 70
                ? "bg-green-600"
                : pct >= 50
                ? "bg-yellow-500"
                : "bg-red-600"
            } h-2 rounded-full" style="width:${pct}%"></div>
          </div>
        `;
          domainBreakdown.appendChild(card);
        });
      }

      // Init
      render();
    </script>
  </body>
</html>
